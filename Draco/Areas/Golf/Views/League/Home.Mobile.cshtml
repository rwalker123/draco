@model SportsManager.Golf.ViewModels.LeagueHomeViewModel

@{
    ViewBag.Title = Model.Account.AccountName;
    Layout = "~/Views/Shared/_Layout.Mobile.cshtml";
}

@if (Model.Season == null)
{
    <h3>No Season Defined</h3>
    <ul data-role="listview">
        <li>@Html.Partial("_LogOnPartial")</li>
        @if (Model.IsAdmin())
        {
            <li>@Html.ActionLink("Create Season", "Index", "Season", new { area = "", accountId = Model.Account.Id }, null)</li>
        }
    </ul>

}
else
{   
    <h4 style="text-align:center">@Model.Season.Name Season</h4>
    <ul data-role="listview">
        <li>@Html.Partial("_LogOnPartial")</li>

        @{
            var flights = Model.RetrieveFlights();
            long singleFlightId = 0;
            
            if (flights.Count() == 1)
            {
                singleFlightId = flights.First().FlightId;
            }
        }

        @if (flights.Count() == 1)
        {
            string handicap = "#handicaps_" + singleFlightId;
            string upcomingMatches = "#upcomingMatches_" + singleFlightId;
            <li>@Html.ActionLink("Standings", "LeagueStandings", "Schedule", new { accountId = Model.AccountId, seasonId = Model.Season.Id, id = singleFlightId }, null)</li>
            <li>@Html.ActionLink("Recent Match Results", "MobileRecentMatch", "Schedule", new { accountId = Model.AccountId, seasonId = Model.Season.Id, id = singleFlightId }, null)</li>
            <li><a href="@upcomingMatches">Upcoming Matches</a></li>
            <li><a href="@handicap">Handicaps</a></li>
        }
        else
        {
            // more than one flight, show the flight name.
            foreach (var flight in flights)
            { 
                string handicap = "#upcomingMatches_" + flight.FlightId;
                string upcomingMatches = "#upcomingMatches_" + flight.FlightId;
                <li>@Html.ActionLink(flight.Name + " Standings", "LeagueStandings", "Schedule", new { accountId = Model.AccountId, seasonId = Model.Season.Id, id = flight.FlightId }, null)</li>
                <li><a href="@upcomingMatches">Upcoming Matches</a></li>
                <li><a href="@handicap">Handicaps</a></li>
            }
        }
    </ul>
}

@section additionalPages
{
    @if (Model.Season != null)
    {
        var flights = Model.RetrieveFlights();

        // more than one flight, show the flight name.
        foreach (var flight in flights)
        {
            string upcomingMatches = "upcomingMatches_" + @flight.FlightId;
            string handicaps = "handicaps_" + @flight.FlightId;
            
            <div data-role="page" id="@upcomingMatches">
                <div data-role="header">
                    <h1>Upcoming Matches</h1>
                </div>

                <div data-role="content">

                @{
                    long flightId = flight.FlightId;
                    var nextMatch = Model.GetNextMatch(flightId);
                }

                @if (nextMatch == null || !nextMatch.Any())
                {
                    <p>No upcoming matches found.</p>
                }
                else
                {
                    foreach (var match in nextMatch)
                    { 
                        <div data-role="button" data-theme="a">@String.Format("{0} vs. {1} ", match.Team1Name, match.Team2Name)</div>
        
                        if (Model.IsAdmin())
                        {
                            <a href='@Url.Action("MatchResults", "Schedule", new { accountId = Model.AccountId, seasonId = Model.Season.Id, flightId = flightId, id = match.MatchId })' data-role="button" data-theme="b">Enter Results</a>
                        }
                    }
                }
                </div>

                <div data-role="footer">
                </div>

            </div>
        
            <div data-role="page" id="@handicaps">
                <div data-role="header">
                    <h1>Handicaps</h1>
                </div>
            
                <div data-role="content">
                    <div class="ui-grid-b">
                        @foreach (var x in Model.GetPlayerHandicaps(flight.FlightId))
                        {
                            <div class="ui-block-a"><a href='@Url.Action("Index", "Player", new { accountId = Model.AccountId, seasonId = Model.Season.Id, id = x.PlayerId })' data-role="button" data-theme="b">@x.PlayerName</a></div>
                            <div class="ui-block-b" data-role="button">@x.HandicapIndex</div>
                        }
                    </div>

                    <div class="ui-grid-b">
                        @foreach (var x in Model.GetSubPlayerHandicaps(flight.FlightId))
                        {
                            <div class="ui-block-a"><a href='@Url.Action("Index", "Player", new { accountId = Model.AccountId, seasonId = Model.Season.Id, id = x.PlayerId })' data-role="button" data-theme="a">@x.PlayerName</a></div>
                            <div class="ui-block-b" data-role="button">@x.HandicapIndex</div>
                        }
                    </div>

                </div>

                <div data-role="footer">
                </div>

            </div>
        }
    }
}
