@model SportsManager.Baseball.ViewModels.LeagueSeasonIndexViewModel
@using System.Web.Optimization;

@{
    ViewBag.Title = @Model.AccountName + " League Setup";
}

@section head {
    <link href="@Url.Content("~/Content/themes/base/jquery-ui.css")" rel="stylesheet" type="text/css" media="screen" />
    <style type="text/css">
        img.over {
            border: 2px dashed #000;
        }

        img {
            border: 2px solid #fff;
        }

        h3.leagueHeader
        {
            font-size:24px;
        }

        ul
        {
            list-style-type: none;
        }

        li.divisionTeam
        {
            font-size: 16px;
            font-style: italic;
            color: gray;
            margin:5px;
        }
    </style>
}

@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>@ViewBag.Title</h1>
                <p>Leagues allow you to run multiple independent groups of teams. You may only schedule games between teams in the same league. Each
                    League can be broken up into divisions.
                </p>
            </hgroup>
                @if (Model.HasSeason)
                {
		            <h2>Current Season: @Model.SeasonName</h2>
                }
        </div> <!-- content-wrapper -->
    </section> <!-- featured -->
    }

@if (!Model.HasSeason)
{
	<h2>You must select an active @Html.ActionLink("Season", "Index", "Season", new { area = "", accountId = Model.AccountId }, null) before creating any Leagues.</h2> 
    return;
}


<div id="copyFromSeason" style="display:none;max-width:500px">
    <h3>Import Previous Season</h3>
    <div >
        <p style="width:400px">Importing a previous season will give you a head start in setting up your league. Importing will bring in the league setup of
            a previous season. This includes the leagues, divisions, teams, and rosters. It does not include schedules, statistics, or any
            other data that involves games played in a season.
        </p>
    Season: <select id="seasonList"></select>
    <input type="button" onclick="leagueSetupData.copySeason(@Model.CurrentSeasonId);" value="Import Season" />
    </div>
</div>

League Name: <input id="newLeagueName" type="text" placeholder="enter league name" pattern=".{1,}" title="Must supply a name" />
<input type="button" onclick="leagueSetupData.addLeague(@Model.CurrentSeasonId)" value="Add League" />

<div id="accordion">
</div>        

@section scripts
{
@Scripts.Render("~/bundles/jsrender")

<script id="teamOptionTemplate" type="text/x-jsrender">
<option value='{{:Id}}'>{{:Name}}</option>
</script>

<script id="seasonOptionTemplate" type="text/x-jsrender">
<option value='{{:Id}}'>{{:Name}}</option>
</script>

<script id="leagueTemplate" type="text/x-jsrender">
<h3 class="leagueHeader" id='leagueHeader_{{:Id}}'><a id='leagueHeaderLink_{{:Id}}' href="#">{{>Name}}</a></h3>
<div id='leagueData_{{:Id}}' class='leagueData'>
    <div style='float:right'>
    League Name: <input id='newLeagueName_{{:Id}}' value='{{>Name}}' /> 
    <input type="button" onclick="leagueSetupData.editLeague({{:Id}})" value="Update Name" />
    <input type="button" onclick="leagueSetupData.deleteLeague({{:Id}})" value="Delete League" />
    </div>
    <div style='clear:both' />
    <br />
    Division Name: <input id="NewDivisionName_{{:Id}}" type="text" placeholder="enter division name" pattern=".{1,}" title="Must supply a name" />
    Sort Order: <input id="NewDivisionPriority_{{:Id}}" type="number" style="width:50px" min="0" max="100" value="1" />
    <input type="button" onclick="leagueSetupData.addDivision({{:Id}})" value="Add Division" />
    <div id="LeagueSetupData_{{:Id}}" data-hasdata="False">
        Loading...
    </div>

    <span style='display:none' id='divisionTeamPanel_{{:Id}}'>
        <select id='divisionTeamSelect_{{:Id}}'>
            <option value='0'>New Team...</option>
        </select>
        <span id='newTeam_{{:Id}}'>Team Name: <input id='newTeamName_{{:Id}}' /></span>
    </span>


</div>
</script>

<script id="teamTemplate" type="text/x-jsrender">
<li class="division_{{>DivisionId}} divisionTeam" id='divisionTeam_{{:Id}}' data-name='{{>Name}}'>
    <input type="button" onclick="leagueSetupData.removeTeamFromDivision({{:LeagueId}}, {{:DivisionId}}, {{:Id}})" value="Remove" />
    
    <img src='/images/busy.gif' id='teamLogoBusy_{{:Id}}'
         style="position: absolute;z-index:1;margin-left:35px;margin-top:25px;border: none;display:none" />
    <img id='teamLogo_{{:Id}}' class='fileupload'
         style="position: relative;vertical-align:middle;width:80px;height:60px" alt="upload team logo"
         data-url='/api/FileUploaderAPI/@Model.AccountId/TeamLogo/{{:TeamId}}' src='/uploads/teams/{{:TeamId}}/logo/teamlogo.png'/>
    <!--
    <img src='/images/busy.gif' id='teamPhotoBusy_{{:Id}}'
         style="position: absolute;z-index:1;margin-left:35px;margin-top:25px;border: none;display:none" />
    <img width="160px" height="70px" id='teamPhoto_{{:Id}}' class='fileupload'
         style="vertical-align:middle" alt="upload team photo" 
         data-url='/api/FileUploaderAPI/@Model.AccountId/TeamPhoto/{{:TeamId}}' src='/uploads/teams/{{:TeamId}}/logo/teamphoto.jpg'/>
    -->

    <span style="vertical-align:middle">{{:Name}}</span>

</li>
</script>

<script id="divisionTemplate" type="text/x-jsrender">
    <div class='divisionItem' id='division_{{:Id}}' data-priority='{{:Priority}}' data-name='{{>Name}}'>
        <h4 id='divisionHeader_{{:Id}}'><span id='divisionHeaderName_{{:Id}}'>{{:Name}}</span>
            <input type="button" onclick="leagueSetupData.editDivision({{:Id}})" value="Edit" />
            <input type="button" onclick="leagueSetupData.deleteDivision({{:Id}})" value="Delete" />
        </h4>
    
        <div id='divisionEdit_{{:Id}}' style='display:none;font-size: 18px'>
            Division Name: <input id="editDivisionName_{{:Id}}" type="text" placeholder="enter division name" pattern=".{1,}" title="Must supply a name" value='{{>Name}}' />
            Sort Order: <input id="editDivisionPriority_{{:Id}}" type="number" style="width:50px" min="0" max="100" value="{{:Priority}}" />
            <input type="button" onclick="leagueSetupData.saveDivisionEdit({{:LeagueId}}, {{:Id}})" value="Save" />
            <input type="button" onclick="leagueSetupData.cancelDivisionEdit({{:Id}})" value="Cancel" />
        </div>

        <div style="margin-left:30px">
            <div id='addDivisionTeamPanel_{{:Id}}' class='addDivisionTeamPanel' style='display:none'>
                <input type="button" onclick="leagueSetupData.addTeamToDivision({{:LeagueId}}, {{:Id}})" value="Add" />
                <input type="button" onclick="leagueSetupData.stopAddTeam({{:LeagueId}}, {{:Id}})" value="Done" />
            </div>
            <div id='divisionTeamEdit_{{:Id}}'>
                <input type="button" onclick="leagueSetupData.startAddTeam({{:LeagueId}}, {{:Id}})" value="Add Team" />
            </div>
        </div>

        <ul class="divisionTeams" id="divisionTeams_{{:Id}}">
            {{for Teams tmpl="#teamTemplate" /}}
            {{if Teams.length <= 0}}
            <li class="placeholder" id='placeholder_{{:Id}}'>{Click add team to add teams to this division.}</li>
            {{else}}
            <li class="placeholder" id='placeholder_{{:Id}}' style='display:none'>{Click add team to add teams to this division.}</li>
            {{/if}}
        </ul>
    </div>
</script>

<script type="text/javascript" src="~/Areas/Baseball/Scripts/leaguesetup.js"></script>

<script type="text/javascript" src="~/Scripts/jQuery-File-Upload-jquery-ui/js/vendor/jquery.ui.widget.js"></script>
<script type="text/javascript" src="~/Scripts/jQuery-File-Upload-jquery-ui/js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="~/Scripts/jQuery-File-Upload-jquery-ui/js/jquery.fileupload.js"></script>

<script type="text/javascript">

    var leagueSetupData = new LeagueSetupClass(@Model.AccountId, @Model.CurrentSeasonId);

    $(document).ready(function () {

        $(document).bind('drop dragover', function (e) {
            e.preventDefault();
        });

        leagueSetupData.fillLeagues();
    });
</script>
}
