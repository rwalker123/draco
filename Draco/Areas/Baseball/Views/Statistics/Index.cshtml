@using SportsManager.Baseball.ViewModels;
@model SeasonStatisticsViewModel

@{
	ViewBag.Title = @Model.AccountName + " Season Statistics";
}

@section menu {
	@Html.Partial("_LeagueMenu")
}

@section head {
	<link href="@Url.Content("~/Content/jquery.jqGrid/ui.jqgrid.css")" rel="stylesheet" type="text/css" media="screen" />
}

<h2>@Model.AccountName Season Statistics</h2>


	@Html.ActionLink("Player Search", "PlayerSearch", "Statistics", new { accountId = Model.AccountId }, null)<br />
	@Html.ActionLink("Player Stats by Team", "PlayerStatsByTeam", "Statistics", new { accountId = Model.AccountId, seasonId = 0, id = 0 }, null)<br />
	@Html.ActionLink("Season Standings", "HistoricalSeasonStandings", "Statistics", new { accountId = Model.AccountId, id = Model.SeasonId }, null)


@using (Html.BeginForm()) {

	@Html.DropDownList("seasonId", Model.GetSeasons())
	@Html.DropDownList("leagueId", new SelectList(new[]{""}))
	@Html.DropDownList("divisionId", new SelectList(new[]{""}))
	<input type="submit" id="showstatsbtn" value="ShowStats" name="Show Stats" />
	<br />


	<!-- Method to get data: GetBatTeamPlayerSeasonTotals -->


	<h3>@Model.SeasonName @Model.LeagueName @Model.DivisionName Leaders</h3>
	<h4>Hitting @Html.ActionLink("sortable stats", "BattingSortableStatistics", "Statistics", new { accountId = Model.AccountId, seasonId = Model.SeasonId, id = Model.LeagueId }, null)</h4>
	<table cellspacing="0" cellpadding="0" border="0">
		<tr valign="top">
		<td>
			@Html.Partial("LeagueLeaders", new LeagueLeadersViewModel(Model.AccountId, Model.LeagueId, Model.DivisionId, category: "AVG", isBatStats: true, allTimeLeaders: Model.UseHistorical, calculateMin: true, fieldFormat: "#.000") )
		</td>
		<td>
			@Html.Partial("LeagueLeaders", new LeagueLeadersViewModel(Model.AccountId, Model.LeagueId, Model.DivisionId, category: "HR", isBatStats: true, allTimeLeaders: Model.UseHistorical, calculateMin: false, fieldFormat: "0") )
		</td>
		<td>
			@Html.Partial("LeagueLeaders", new LeagueLeadersViewModel(Model.AccountId, Model.LeagueId, Model.DivisionId, category: "RBI", isBatStats: true, allTimeLeaders: Model.UseHistorical, calculateMin: false, fieldFormat: "0") )
		</tr>
	</table>

	<h4>Pitching @Html.ActionLink("sortable stats", "PitchingSortableStatistics", "Statistics", new { accountId = Model.AccountId, seasonId = Model.SeasonId, id = Model.LeagueId }, null)</h4>
	<table cellspacing="0" cellpadding="0" border="0">
		<tr valign="top">
		<td>
			@Html.Partial("LeagueLeaders", new LeagueLeadersViewModel(Model.AccountId, Model.LeagueId, Model.DivisionId, category: "W", isBatStats: false, allTimeLeaders: Model.UseHistorical, calculateMin: true, fieldFormat: "0") )
		</td>
		<td>
			@Html.Partial("LeagueLeaders", new LeagueLeadersViewModel(Model.AccountId, Model.LeagueId, Model.DivisionId, category: "SO", isBatStats: false, allTimeLeaders: Model.UseHistorical, calculateMin: true, fieldFormat: "0") )
		</td>
		<td>
			@Html.Partial("LeagueLeaders", new LeagueLeadersViewModel(Model.AccountId, Model.LeagueId, Model.DivisionId, category: "WHIP", isBatStats: false, allTimeLeaders: Model.UseHistorical, calculateMin: true, fieldFormat: "0.00") )
		</td>
		</tr>
	</table>
}


@section Scripts {

<script src="@Url.Content("~/Scripts/jquery.jqGrid/grid.locale-en.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.jqGrid/jquery.jqGrid.min.js")" type="text/javascript"></script>

<script type="text/javascript">

    $(document).ready(function () {
	    loadLeagues();
    });

    $(function() {
	    $("#seasonId").change(loadLeagues);
	    $("#leagueId").change(loadDivisions);
    });

    function loadLeagues() {
		var selectedSeason = $("#seasonId").val();

		 $("#showstatsbtn").attr('disabled', 'disabled');

		var url;
		if (selectedSeason == 0)
			url = '@Url.Action("GetHistoricalLeagues", "Statistics")';
		else
			url = '@Url.Action("GetLeagues", "Statistics")';
		url = url + "/" + @Model.AccountId + "/" + selectedSeason
		$("#leagueId").empty(); 
		$.getJSON(url, function(leagues) {
			$.each(leagues, function() {
				$("#leagueId").append($("<option></option>").val(this['Id']).html(this['Name']));
			});

			$("#leagueId").val(@Model.LeagueId);

			if (selectedSeason == 0)
			{
				$("#divisionId").empty(); 
				$("#divisionId").append($("<option></option>").val('0').html('No Filter'));
				$("#divisionId").hide();
				$("#showstatsbtn").removeAttr('disabled');
			}
			else
			{
				$("#divisionId").show();
				loadDivisions();
			}
	   });
	}

    function loadDivisions() {
		 $("#showstatsbtn").attr('disabled', 'disabled');

		var selectedLeague = $("#leagueId").val();
		var url = '@Url.Action("GetDivisions", "Statistics")';
		url = url + "/" + @Model.AccountId + "/" + selectedLeague
		$("#divisionId").empty(); 
		$.getJSON(url, function(divisions) {
			$("#divisionId").append($("<option></option>").val('0').html('No Filter'));

			$.each(divisions, function() {
				$("#divisionId").append($("<option></option>").val(this['Id']).html(this['Name']));
			});

			$("#divisionId").val(@Model.DivisionId);
			$("#showstatsbtn").removeAttr('disabled');
	   });
	}

</script>

@Html.Partial("_DisplayPlayer")

}


