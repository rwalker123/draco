@model SportsManager.ViewModels.UsersViewModel
@using System.Web.Optimization;

@{
    ViewBag.Title = @Model.AccountName + " Users";
}

@section head
{
@Styles.Render("~/Content/themes/base/css")
    <style type="text/css">
        img.over {
            border: 2px dashed #000;
        }

        img {
            border: 2px solid #fff;
        }

        h3.userHeader
        {
            font-size:24px;
        }

        ul
        {
            list-style-type: none;
        }

    </style>
}


<div class="jumbotron">
    <h1>@ViewBag.Title.</h1>
    <p class="help-block">
        Manage website users.

        <a class="btn btn-success" href="@Url.Action("EMail", "Account", new { area = "", accountId = Model.AccountId }, null)">Email Users &raquo;</a>
    </p>
</div> <!-- content-wrapper -->

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="deleteModalLabel">Confirm Delete User</h4>
            </div>
            <div class="modal-body" id="deleteModalBody">
                You are about to delete a user. All data associated with the user will be permanently deleted. You cannot undo this operation. Are you sure you want to continue?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal" id="confirmDeleteBtn">Continue</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<form class="form-inline" role="form" id="newContact">
    <small>create contact</small><br />
    <div style="display:inline-block" data-bind="template: { name: function () { return selectedView(); } }" class="contactView" ></div>
</form>

<div id="accordion">

    <small>filter user list</small><br />
    <form class="form-inline" role="form">
        <select data-container="body" data-bind="selectPicker: filterField, selectPickerOptions: {optionsArray: availableFilters}, optionsText: 'name', optionsValue: 'id'"></select>
        <select data-container="body" data-bind="selectPicker: filterOp, selectPickerOptions: {optionsArray: availableOperations}, optionsText: 'name', optionsValue: 'id'"></select>
        <input type="text" class="form-control" style="width:200px" data-bind="value: filterValue" placeholder="filter text" />
        <select data-container="body" data-bind="selectPicker: filterSort, selectPickerOptions: {optionsArray: availableSort}, optionsText: 'name', optionsValue: 'id'"></select>
        <button type="button" class="btn btn-default" data-bind="click: applyFilter"><span class="glyphicon glyphicon-ok"></span></button>
    </form>

    <ul class="pager">
        <li class="previous"><a data-bind="visible: prevPagesAvailable, click: gotoPrev">&larr; Prev</a></li>
        <li class="next"><a data-bind="visible: nextPage, click: gotoNext">Next &rarr;</a></li>
        @*<li>Page: <span data-bind="text: currentPageNo"></span>/<span data-bind="text: totalPages"></span></li>*@
    </ul>
    @*<div style="clear: both"></div>*@
    <div data-bind="foreach: users">
        <h3 class="userHeader">
            <img src='@Url.Content("~/images/busy.gif")'
                 style="position: absolute;z-index:1;margin-left:35px;margin-top:25px;border: none;display:none" />
            <img class='fileupload' 
            style="width: 80px; height: 60px; position: relative;vertical-align:middle;" 
            data-bind="imageUploader: fileUploaderUrl, attr : { src: photoUrl }"
            alt="upload photo" />
            <a href="#" data-bind="text: fullName"></a>
        </h3>
        <div>
            <form class="form-inline" role="form" data-bind="attr: { id: id }">
                <div class="contactView" data-bind="template: { name: function () { return selectedView(); }, afterRender: userRendered }"></div>
            </form>
        </div>
    </div>
    <ul class="pager">
        <li class="previous"><a data-bind="visible: prevPagesAvailable, click: gotoPrev">&larr; Prev</a></li>
        <li class="next"><a data-bind="visible: nextPage, click: gotoNext">Next &rarr;</a></li>
    </ul>
    @*<button style="float:right" class="btn btn-info" type="button" data-bind="visible: nextPage, click: gotoNext">Next >></button>
        <button style="float:left" class="btn btn-info" type="button" data-bind="visible: prevPagesAvailable, click: gotoPrev"><< Prev</button>
        <div style="text-align:center;padding-top:10px">Page: <span data-bind="text: currentPageNo"></span>/<span data-bind="text:totalPages"></span></div>
        <div style="clear: both"></div>*@
</div>

@section scripts 
{

<script id="viewUserDetailsTemplate" type="text/html">

    <div data-bind="with: details">
        <address data-bind="visible: email()">
            <small>email</small><br /><a data-bind="text: email, attr: {href: 'mailto:' + email()}"></a>
        </address>
        <address data-bind="visible: phone1()">
            <small>home phone</small><br /><span data-bind="text: phone1"></span>
        </address>
        <address data-bind="visible: phone2()">
            <small>cell phone</small><br /><span data-bind="text: phone2"></span>
        </address>
        <address data-bind="visible: phone3()">
            <small>work phone</small><br /><span data-bind="text: phone3"></span>
        </address>
        <address data-bind="visible: address() || city() || state() || zip()" style="vertical-align: top">
            <small>address</small><br />
            <span data-bind="text: address"></span><br />
            <span data-bind="text: city"></span>, <span data-bind="text: state"></span> <span data-bind="text: zip"></span>
        </address>
        <address data-bind="visible: birthdate()">
            <small>Date of Birth:</small><br /><span data-bind="text: $parent.birthdateDisplay"></span>
        </address>
        <address>
            <small>first year</small><br /><span data-bind="text: firstYear"></span>
        </address>
        <address>
            <small>gender</small><br /><span data-bind="text: gender() ? 'Female' : 'Male'"></span>
        </address>
    </div>
    <div class="contactErrorLocation" style="margin: 10px">

    </div>

    <button type="button" class="btn btn-default" data-bind="click: beginEditContact"><span class="glyphicon glyphicon-edit"></span></button>
    <button type="button" class="btn btn-danger" data-bind="click: $parent.deleteUser"><span class="glyphicon glyphicon-remove"></span></button>
    <button type="button" class="btn btn-warning" data-bind="visible: isRegistered, click: resetPassword">Reset Password</button>
    <button type="button" class="btn btn-warning" data-bind="visible: canRegister, click: registerUser">Register User</button><br />
    <br />

</script>

<script id="editUserDetailsTemplate" type="text/html">

    <div class="form-group" style="margin-bottom:10px">
        <input type="text" class="form-control" data-bind="value: firstName, enable: namesEnabled" placeholder="first name" name="firstname" style="width: 150px" />
        <input type="text" class="form-control" data-bind="value: middleName, enable: namesEnabled" placeholder="middle name" style="width: 125px" />
        <input type="text" class="form-control" data-bind="value: lastName, enable: namesEnabled" placeholder="last name" name="lastname" style="width: 150px" />
        <button type="button" class="btn btn-primary" data-bind="visible: namesEnabled() && !detailsVisible(), click: beginCreateContact"><span class="glyphicon glyphicon-plus"></span></button>
    </div>

    <div data-bind="with: details, fadeVisible: detailsVisible">

        <div class="form-group">
            <small>email</small><br />
            <label data-bind="uniqueFor: $parent.id" class='sr-only'>email</label>
            <input type="email" class="form-control" data-bind="value: email, uniqueId: $parent.id" placeholder="email address" style="width: 400px" />
        </div>
        <br />

        <div class="form-group" style="margin-top:10px">
            <small>phone numbers</small><br />
            <label data-bind="uniqueFor: $parent.id" class="control-label"><abbr title="Cell Phone">c</abbr></label>
            <input type="tel" data-bind="phoneNumber: phone1, uniqueId: $parent.id" class="form-control" placeholder="cell phone" />

            <label data-bind="uniqueFor: $parent.id" class="control-label"><abbr title="Home Phone">h</abbr></label>
            <input type="tel" data-bind="phoneNumber: phone2, uniqueId: $parent.id" class="form-control" placeholder="home phone" />

            <label data-bind="uniqueFor: $parent.id" class="control-label"><abbr title="Work Phone">w</abbr></label>
            <input type="tel" data-bind="phoneNumber: phone3, uniqueId: $parent.id" class="form-control" placeholder="work phone" />
        </div>

        <br />

        <div class="form-group" style="margin-top:10px">
            <small>address</small><br />
            <label data-bind="uniqueFor: $parent.id" class="sr-only">Street Address</label>
            <input type="text" class="form-control" data-bind="value: address, uniqueId: $parent.id" placeholder="street address" style="width: 300px" /> <br />

            <label data-bind="uniqueFor: $parent.id" class="sr-only">City</label>
            <input type="text" class="form-control" data-bind="value: city, uniqueId: $parent.id" placeholder="city" style="width: 200px" />

            <label data-bind="uniqueFor: $parent.id" class="sr-only">State</label>
            <select data-container="body" data-size="7" data-bind="uniqueId: $parent.id, selectPicker: state, selectPickerOptions: {optionsArray: $parent.availableStates}, optionsText: 'name', optionsValue: 'abbrev', optionsCaption: 'Choose state...'"></select>

            <label data-bind="uniqueFor: $parent.id" class="sr-only">Zip Code</label>
            <input type="text" class="form-control" data-bind="value: zip, uniqueId: $parent.id" style="width: 75px" placeholder="zip" />
        </div>

        <br />

        <div class="form-group" style="margin-top:10px">
            <small>date of birth</small><br />
            <label data-bind="uniqueFor: $parent.id" class="sr-only">Date of Birth</label>
            <input type="text" data-bind="uniqueId: $parent.id, datepicker: birthdate, datepickerOptions: { format: 'MM dd, yyyy', autoclose: true, startView: 2 }" class="form-control" placeholder="birth date" /><br />
            <small>choose first year</small><br />
            <label data-bind="uniqueFor: $parent.id" class="sr-only">First Year</label>
            <select data-container="body" data-bind="uniqueId: $parent.id, selectPicker: firstYear, selectPickerOptions: { optionsArray: $parent.availableYears }, optionsText: 'name', optionsValue: 'name', optionsCaption: 'Choose first year...'"></select><br />
        </div>
        <br />
        <div class="form-group" style="margin-top:10px">
            <small>gender</small><br />
            <label data-bind="uniqueFor: $parent.id" class="sr-only">Gender</label>
            <select data-container="body" data-bind="uniqueId: $parent.id, selectPicker: gender, selectPickerOptions: { optionsArray: $parent.availableGenders }, optionsText: 'name', optionsValue: 'id', optionsCaption: 'Choose gender...'"></select><br />
        </div>
        <br />
        <div class="form-group" style="margin-top:10px" data-bind="visible: $parent.showCreateAccount">
            <input type="checkbox" data-bind="checked: $parent.createAccount, uniqueId: $parent.id">
            <label data-bind="uniqueFor: $parent.id">
                register user account (email will be sent to user)
            </label>
        </div>
    </div>

    <div class="form-group" style="margin-top:10px;margin-bottom:20px" data-bind="visible: detailsVisible">
        <button type="submit" class="btn btn-success"><span class="glyphicon glyphicon-ok"></span></button>
        <button type="button" class="btn btn-danger" data-bind="click: cancelContact"><span class="glyphicon glyphicon-remove"></span></button><br />
    </div>

    <div class="contactErrorLocation"></div>
    <div data-bind="visible: validatingName" class="alert alert-info"><i class="fa fa-spinner fa-spin fa-2x"></i> validating name...</div>

</script>

@Scripts.Render("~/bundles/knockout")

<script type="text/javascript" src="~/Scripts/userdata.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.maskedinput-1.3.1.min.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.validate.min.js"></script>
@Scripts.Render("~/bundles/jquery-file-upload")

<script type="text/javascript">
    $(document).ready(function () {
        initUserData(@Model.AccountId, @Model.PageSize, @Model.AccountFirstYear);
    });
</script>
}
